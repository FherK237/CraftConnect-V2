"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const index_js_1 = require("../../../../../src/management/core/url/index.js");
describe("join", () => {
    describe("basic functionality", () => {
        it("should return empty string for empty base", () => {
            expect((0, index_js_1.join)("")).toBe("");
            expect((0, index_js_1.join)("", "path")).toBe("");
        });
        it("should handle single segment", () => {
            expect((0, index_js_1.join)("base", "segment")).toBe("base/segment");
            expect((0, index_js_1.join)("base/", "segment")).toBe("base/segment");
            expect((0, index_js_1.join)("base", "/segment")).toBe("base/segment");
            expect((0, index_js_1.join)("base/", "/segment")).toBe("base/segment");
        });
        it("should handle multiple segments", () => {
            expect((0, index_js_1.join)("base", "path1", "path2", "path3")).toBe("base/path1/path2/path3");
            expect((0, index_js_1.join)("base/", "/path1/", "/path2/", "/path3/")).toBe("base/path1/path2/path3/");
        });
    });
    describe("URL handling", () => {
        it("should handle absolute URLs", () => {
            expect((0, index_js_1.join)("https://example.com", "api", "v1")).toBe("https://example.com/api/v1");
            expect((0, index_js_1.join)("https://example.com/", "/api/", "/v1/")).toBe("https://example.com/api/v1/");
            expect((0, index_js_1.join)("https://example.com/base", "api", "v1")).toBe("https://example.com/base/api/v1");
        });
        it("should preserve URL query parameters and fragments", () => {
            expect((0, index_js_1.join)("https://example.com?query=1", "api")).toBe("https://example.com/api?query=1");
            expect((0, index_js_1.join)("https://example.com#fragment", "api")).toBe("https://example.com/api#fragment");
            expect((0, index_js_1.join)("https://example.com?query=1#fragment", "api")).toBe("https://example.com/api?query=1#fragment");
        });
        it("should handle different protocols", () => {
            expect((0, index_js_1.join)("http://example.com", "api")).toBe("http://example.com/api");
            expect((0, index_js_1.join)("ftp://example.com", "files")).toBe("ftp://example.com/files");
            expect((0, index_js_1.join)("ws://example.com", "socket")).toBe("ws://example.com/socket");
        });
        it("should fallback to path joining for malformed URLs", () => {
            expect((0, index_js_1.join)("not-a-url://", "path")).toBe("not-a-url:///path");
        });
    });
    describe("edge cases", () => {
        it("should handle empty segments", () => {
            expect((0, index_js_1.join)("base", "", "path")).toBe("base/path");
            expect((0, index_js_1.join)("base", null, "path")).toBe("base/path");
            expect((0, index_js_1.join)("base", undefined, "path")).toBe("base/path");
        });
        it("should handle segments with only slashes", () => {
            expect((0, index_js_1.join)("base", "/", "path")).toBe("base/path");
            expect((0, index_js_1.join)("base", "//", "path")).toBe("base/path");
        });
        it("should handle base paths with trailing slashes", () => {
            expect((0, index_js_1.join)("base/", "path")).toBe("base/path");
        });
        it("should handle complex nested paths", () => {
            expect((0, index_js_1.join)("api/v1/", "/users/", "/123/", "/profile")).toBe("api/v1/users/123/profile");
        });
    });
    describe("real-world scenarios", () => {
        it("should handle API endpoint construction", () => {
            const baseUrl = "https://api.example.com/v1";
            expect((0, index_js_1.join)(baseUrl, "users", "123", "posts")).toBe("https://api.example.com/v1/users/123/posts");
        });
        it("should handle file path construction", () => {
            expect((0, index_js_1.join)("/var/www", "html", "assets", "images")).toBe("/var/www/html/assets/images");
        });
        it("should handle relative path construction", () => {
            expect((0, index_js_1.join)("../parent", "child", "grandchild")).toBe("../parent/child/grandchild");
        });
        it("should handle Windows-style paths", () => {
            expect((0, index_js_1.join)("C:\\Users", "Documents", "file.txt")).toBe("C:\\Users/Documents/file.txt");
        });
    });
    describe("performance scenarios", () => {
        it("should handle many segments efficiently", () => {
            const segments = Array(100).fill("segment");
            const result = (0, index_js_1.join)("base", ...segments);
            expect(result).toBe("base/" + segments.join("/"));
        });
        it("should handle long URLs", () => {
            const longPath = "a".repeat(1000);
            expect((0, index_js_1.join)("https://example.com", longPath)).toBe(`https://example.com/${longPath}`);
        });
    });
    describe("trailing slash preservation", () => {
        it("should preserve trailing slash on final result when base has trailing slash and no segments", () => {
            expect((0, index_js_1.join)("https://api.example.com/")).toBe("https://api.example.com/");
            expect((0, index_js_1.join)("https://api.example.com/v1/")).toBe("https://api.example.com/v1/");
        });
        it("should preserve trailing slash when last segment has trailing slash", () => {
            expect((0, index_js_1.join)("https://api.example.com", "users/")).toBe("https://api.example.com/users/");
            expect((0, index_js_1.join)("api/v1", "users/")).toBe("api/v1/users/");
        });
        it("should preserve trailing slash with multiple segments where last has trailing slash", () => {
            expect((0, index_js_1.join)("https://api.example.com", "v1", "collections/")).toBe("https://api.example.com/v1/collections/");
            expect((0, index_js_1.join)("base", "path1", "path2/")).toBe("base/path1/path2/");
        });
    });
});
